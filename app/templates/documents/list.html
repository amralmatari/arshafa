{% extends "base.html" %}
{% set title = "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚" %}

{% block head %}
<meta name="csrf-token" content="{{ csrf_token() }}">
<style>
    /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ */
    .filter-toggle-btn {
        border-radius: 20px;
        padding: 6px 12px;
        font-weight: 500;
        font-size: 0.875rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: all 0.2s ease;
    }

    .filter-toggle-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ù‚Ø³Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ */
    .sort-section {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-top: 1px solid #dee2e6;
    }

    .btn-group .btn {
        margin: 2px;
        border-radius: 20px !important;
    }

    /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .document-card {
        transition: transform 0.2s;
    }
    .document-card:hover {
        transform: translateY(-2px);
    }
    .status-badge {
        font-size: 0.8rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>
            <i class="fas fa-file-alt me-2"></i>
            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
        </h1>
        <!-- Toggle Button for Filters -->
        <button class="btn btn-outline-secondary btn-sm filter-toggle-btn" type="button" data-bs-toggle="collapse" data-bs-target="#filtersSection" aria-expanded="true" aria-controls="filtersSection">
            <i class="fas fa-filter me-1"></i>
            <span id="filter-toggle-text">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ„Ø§ØªØ±</span>
            <i class="fas fa-chevron-up ms-1" id="filter-toggle-icon"></i>
        </button>
    </div>

    <!-- Collapsible Filters and Sort Section -->
    <div class="collapse show" id="filtersSection">
        <!-- Filter Form -->
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="fas fa-filter me-2"></i>
                    ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
                </h6>
                <div class="d-flex gap-1">
                    <button type="submit" form="filter-form" class="btn btn-primary btn-sm">
                        <i class="fas fa-search me-1"></i>
                        Ø¨Ø­Ø« ÙˆØªØµÙÙŠØ©
                    </button>
                    {% if current_search or current_main_category or current_sub_category_1 or current_sub_category_2 or current_sub_category_3 or current_doc_type or current_author or current_start_date or current_end_date or current_time_filter %}
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearAllFilters()">
                        <i class="fas fa-times me-1"></i>
                        Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„
                    </button>
                    {% endif %}
                </div>
            </div>
        <div class="card-body py-3">
            <form method="get" action="{{ url_for('documents.list_documents') }}" id="filter-form" onsubmit="return true;">

                <!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„: Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© ÙˆÙÙ„Ø§ØªØ± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label small fw-bold text-primary mb-2">
                            <i class="fas fa-sitemap me-1"></i>
                            ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
                        </label>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex flex-grow-1 align-items-center gap-4">
                            
                            <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠØ© -->
                            <div class="d-flex gap-2 align-items-center">
                                <!-- ÙÙ„ØªØ± Ø²Ù…Ù†ÙŠ Ø³Ø±ÙŠØ¹ -->
                                <div class="d-flex filter-toggle-text align-items-center">
                                    <label for="time_filter" class="form-label mb-1 text-muted small text-center">
                                        ğŸ•°ï¸ ÙÙ„Ø§ØªØ± Ø²Ù…Ù†ÙŠØ© 
                                    </label>
                                    <select name="time_filter" id="time_filter" class="form-select form-select-sm border-primary"
                                            style="width: 120px; font-size: 0.85rem;" onchange="this.form.submit()">
                                        <option value="" {% if not current_time_filter %}selected{% endif %}>
                                            ğŸ“… Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©
                                        </option>
                                        <option value="daily" {% if current_time_filter == 'daily' %}selected{% endif %}>
                                            ğŸŒ… ÙŠÙˆÙ…ÙŠ (Ø§Ù„ÙŠÙˆÙ…)
                                        </option>
                                        <option value="monthly" {% if current_time_filter == 'monthly' %}selected{% endif %}>
                                            ğŸ“… Ø´Ù‡Ø±ÙŠ (Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)
                                        </option>
                                        <option value="yearly" {% if current_time_filter == 'yearly' %}selected{% endif %}>
                                            ï¿½ï¸ Ø³Ù†ÙˆÙŠ (Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©)
                                        </option>
                                    </select>
                                </div>

                                <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                                <div class="vr" style="height: 40px; opacity: 0.3;"></div>

                                <!-- ÙÙ„Ø§ØªØ± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµØ© -->
                                <div class="d-flex gap-2">
                                    <div class="d-flex filter-toggle-text align-items-center">
                                        <label for="start_date" class="form-label mb-1 text-muted small">
                                            ğŸ“… Ù…Ù† 
                                        </label>
                                        <input type="date" name="start_date" id="start_date" class="form-control form-control-sm"
                                               style="width: 140px; font-size: 0.85rem;" value="{{ current_start_date or '' }}">
                                    </div>
                                    <div class="d-flex flex-grow-1 align-items-center">
                                        <label for="end_date" class="form-label mb-1 text-muted small">
                                            ğŸ“… Ø¥Ù„Ù‰ 
                                        </label>
                                        <input type="date" name="end_date" id="end_date" class="form-control form-control-sm"
                                               style="width: 140px; font-size: 0.85rem;" value="{{ current_end_date or '' }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <!-- Main Category -->
                    <div class="col-lg-3 col-md-6 mb-2">
                        <select name="main_category" id="main_category" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                            {% for category in main_categories %}
                            <option value="{{ category.id }}" {% if current_main_category == category.id %}selected{% endif %}>
                                ğŸ“‚ {{ category.get_display_name() }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Sub Category 1 -->
                    <div class="col-lg-3 col-md-6 mb-2">
                        <select name="sub_category_1" id="sub_category_1" class="form-select form-select-sm" disabled onchange="this.form.submit()">
                            <option value="">ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©</option>
                        </select>
                    </div>

                    <!-- Sub Category 2 -->
                    <div class="col-lg-3 col-md-6 mb-2">
                        <select name="sub_category_2" id="sub_category_2" class="form-select form-select-sm" disabled onchange="this.form.submit()">
                            <option value="">ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ© Ø«Ø§Ù†ÙŠØ©</option>
                        </select>
                    </div>

                    <!-- Sub Category 3 -->
                    <div class="col-lg-3 col-md-6 mb-2">
                        <select name="sub_category_3" id="sub_category_3" class="form-select form-select-sm" disabled onchange="this.form.submit()">
                            <option value="">ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ© Ø«Ø§Ù„Ø«Ø©</option>
                        </select>
                    </div>
                </div>

                <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¨Ø­Ø« ÙˆÙÙ„Ø§ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙˆØ§Ù„Ù…Ø¤Ù„Ù -->
                <div class="row mb-3">
                    <!-- Search Field -->
                    <div class="col-lg-4 col-md-6 mb-2">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text bg-light border-end-1">
                                <i class="fas fa-search text-muted"></i>
                            </span>
                            <input type="text"
                                   name="search"
                                   id="search"
                                   class="form-control form-control-sm border-start-1"
                                   placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚..."
                                   value="{{ current_search or '' }}">
                        </div>
                    </div>

                    <!-- Document Type Filter -->
                    <div class="col-lg-4 col-md-6 mb-2">
                        <select name="doc_type" id="doc_type" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="" {% if not current_doc_type or current_doc_type == '' %}selected{% endif %}>
                                ğŸ“„ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                            </option>
                            {% for doc_type in doc_types %}
                            <option value="{{ doc_type.value }}"
                                    {% if current_doc_type and current_doc_type != '' and current_doc_type != 'None' and (current_doc_type == doc_type.value or current_doc_type in doc_type.extensions) %}selected{% endif %}>
                                {{ doc_type.display }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Author Filter -->
                    <div class="col-lg-4 col-md-6 mb-2">
                        <select name="author" id="author" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">ğŸ‘¥ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ†</option>
                            {% for author in authors %}
                            <option value="{{ author.id }}" {% if current_author == author.id %}selected{% endif %}>
                                {% if author.first_name and author.last_name %}
                                    ğŸ‘¤ {{ author.first_name }} {{ author.last_name }}
                                {% else %}
                                    ğŸ‘¤ {{ author.username }}
                                {% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>




            </form>
        </div>

        <!-- Sort Options -->
        <div class="card-footer sort-section">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <h6 class="mb-0">
                        <i class="fas fa-sort me-2"></i>
                        ØªØ±ØªÙŠØ¨ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                    </h6>
                </div>
                <div class="col-md-9">
                    <div class="btn-group flex-wrap" role="group" aria-label="Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨">
                <a href="{{ url_for('documents.list_documents',
                    search=current_search,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    sort='newest') }}"
                   class="btn btn-outline-primary btn-sm {{ 'active' if request.args.get('sort', 'newest') == 'newest' else '' }}">
                    <i class="fas fa-clock me-1"></i>
                    Ø§Ù„Ø£Ø­Ø¯Ø«
                </a>
                <a href="{{ url_for('documents.list_documents',
                    search=current_search,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    sort='file_type') }}"
                   class="btn btn-outline-primary btn-sm {{ 'active' if request.args.get('sort') == 'file_type' else '' }}">
                    <i class="fas fa-file me-1"></i>
                    Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                </a>
                <a href="{{ url_for('documents.list_documents',
                    search=current_search,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    sort='status') }}"
                   class="btn btn-outline-primary btn-sm {{ 'active' if request.args.get('sort') == 'status' else '' }}">
                    <i class="fas fa-flag me-1"></i>
                    Ø§Ù„Ø­Ø§Ù„Ø©
                </a>
                <a href="{{ url_for('documents.list_documents',
                    search=current_search,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    sort='author') }}"
                   class="btn btn-outline-primary btn-sm {{ 'active' if request.args.get('sort') == 'author' else '' }}">
                    <i class="fas fa-user me-1"></i>
                    Ø§Ù„Ù…Ø¤Ù„Ù
                </a>
                <a href="{{ url_for('documents.list_documents',
                    search=current_search,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    sort='title') }}"
                   class="btn btn-outline-primary btn-sm {{ 'active' if request.args.get('sort') == 'title' else '' }}">
                    <i class="fas fa-sort-alpha-down me-1"></i>
                    Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End of collapsible section -->

    <!-- Active Filters Display -->
    {% set active_filters = [] %}
    {% if current_search %}
        {% set _ = active_filters.append(('Ø§Ù„Ø¨Ø­Ø«', current_search)) %}
    {% endif %}

    <!-- Hierarchical Category Filters -->
    {% if current_main_category %}
        {% for category in main_categories %}
            {% if category.id == current_main_category %}
                {% set _ = active_filters.append(('Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', category.get_display_name())) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if current_sub_category_1 %}
        {% for category in categories %}
            {% if category.id == current_sub_category_1 %}
                {% set _ = active_filters.append(('Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰', category.get_display_name())) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if current_sub_category_2 %}
        {% for category in categories %}
            {% if category.id == current_sub_category_2 %}
                {% set _ = active_filters.append(('Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©', category.get_display_name())) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if current_sub_category_3 %}
        {% for category in categories %}
            {% if category.id == current_sub_category_3 %}
                {% set _ = active_filters.append(('Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©', category.get_display_name())) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if current_doc_type %}
        {% set doc_type_display = current_doc_type.upper() %}
        {% for doc_type in doc_types %}
            {% if doc_type.value == current_doc_type or current_doc_type in doc_type.extensions %}
                {% set doc_type_display = doc_type.display %}
            {% endif %}
        {% endfor %}
        {% set _ = active_filters.append(('Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©', doc_type_display)) %}
    {% endif %}

    {% if current_author %}
        {% for author in authors %}
            {% if author.id == current_author %}
                {% set author_name = (author.first_name + ' ' + author.last_name) if author.first_name and author.last_name else author.username %}
                {% set _ = active_filters.append(('Ø§Ù„Ù…Ø¤Ù„Ù', author_name)) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if current_time_filter %}
        {% if current_time_filter == 'daily' %}
            {% set _ = active_filters.append(('Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ', 'ÙŠÙˆÙ…ÙŠ')) %}
        {% elif current_time_filter == 'monthly' %}
            {% set _ = active_filters.append(('Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ', 'Ø´Ù‡Ø±ÙŠ')) %}
        {% elif current_time_filter == 'yearly' %}
            {% set _ = active_filters.append(('Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ', 'Ø³Ù†ÙˆÙŠ')) %}
        {% endif %}
    {% elif current_start_date or current_end_date %}
        {% if current_start_date and current_end_date %}
            {% set _ = active_filters.append(('Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ', 'Ù…Ù† ' + current_start_date + ' Ø¥Ù„Ù‰ ' + current_end_date)) %}
        {% elif current_start_date %}
            {% set _ = active_filters.append(('Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ', 'Ù…Ù† ' + current_start_date)) %}
        {% elif current_end_date %}
            {% set _ = active_filters.append(('Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ', 'Ø­ØªÙ‰ ' + current_end_date)) %}
        {% endif %}
    {% endif %}

    {% if active_filters %}
    <div class="alert alert-info mb-3">
        <div class="d-flex align-items-center justify-content-between flex-wrap">
            <div class="mb-2 mb-md-0 flex-grow-1">
                <i class="fas fa-filter me-2 text-info"></i>
                <strong>Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù†Ø´Ø·Ø©:</strong>
                <div class="d-inline-block ms-2">
                    {% for filter_name, filter_value in active_filters %}
                        {% if filter_name == 'Ø§Ù„Ø¨Ø­Ø«' %}
                            <span class="badge bg-primary me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('search')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' %}
                            <span class="badge bg-success me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('main_category')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰' %}
                            <span class="badge bg-info me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('sub_category_1')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©' %}
                            <span class="badge bg-warning me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('sub_category_2')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©' %}
                            <span class="badge bg-secondary me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('sub_category_3')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©' %}
                            <span class="badge bg-dark me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('doc_type')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ø§Ù„Ù…Ø¤Ù„Ù' %}
                            <span class="badge bg-danger me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('author')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% elif filter_name == 'Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ' %}
                            <span class="badge bg-dark me-1 mb-1 filter-badge" style="cursor: pointer;"
                                  onclick="removeFilter('date')"
                                  title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±">
                                ğŸ“… {{ filter_name }}: {{ filter_value }}
                                <i class="fas fa-times ms-1"></i>
                            </span>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <a href="{{ url_for('documents.list_documents') }}" class="btn btn-xs btn-outline-danger" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">
                <i class="fas fa-times me-1"></i>
                Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Return to Categories Button -->
    {% if request.args.get('return_to') == 'admin_categories' %}
    <div class="mb-3">
        <a href="{{ url_for('admin.list_categories') }}{% if request.args.get('return_category_id') %}#category-{{ request.args.get('return_category_id') }}{% endif %}"
           class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-right me-1"></i>
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª
        </a>
    </div>
    {% endif %}

    <!-- Results Summary -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h5 class="mb-0">
                <i class="fas fa-file-alt me-2"></i>
                Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                {% if active_filters %}
                    <span class="badge bg-info ms-2">
                        <i class="fas fa-filter me-1"></i>
                        Ù…ÙÙ„ØªØ±Ø© ({{ active_filters|length }} ÙÙ„ØªØ±)
                    </span>
                {% endif %}
            </h5>
            <small class="text-muted">
                {% if documents.total > 0 %}
                    {% if active_filters %}
                        <i class="fas fa-search me-1"></i>
                        ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ {{ documents.total }} ÙˆØ«ÙŠÙ‚Ø© ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«
                        {% if documents.pages > 1 %}
                            - Ø¹Ø±Ø¶ {{ documents.items|length }} ÙˆØ«ÙŠÙ‚Ø© (Ø§Ù„ØµÙØ­Ø© {{ documents.page }} Ù…Ù† {{ documents.pages }})
                        {% endif %}
                    {% else %}
                        Ø¹Ø±Ø¶ {{ documents.items|length }} Ù…Ù† Ø£ØµÙ„ {{ documents.total }} ÙˆØ«ÙŠÙ‚Ø©
                        {% if documents.pages > 1 %}
                            (Ø§Ù„ØµÙØ­Ø© {{ documents.page }} Ù…Ù† {{ documents.pages }})
                        {% endif %}
                    {% endif %}
                {% else %}
                    {% if active_filters %}
                        <i class="fas fa-exclamation-triangle me-1 text-warning"></i>
                        Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ«Ø§Ø¦Ù‚ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    {% else %}
                        Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ«Ø§Ø¦Ù‚
                    {% endif %}
                {% endif %}
            </small>
        </div>
        <div class="d-flex gap-2">
            {% if request.args.get('return_to') == 'admin_categories' %}
            <a href="{{ url_for('admin.list_categories') }}{% if request.args.get('return_category_id') %}#category-{{ request.args.get('return_category_id') }}{% endif %}"
               class="btn btn-outline-secondary">
                <i class="fas fa-arrow-right me-1"></i>
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙØ¦Ø§Øª
            </a>
            {% endif %}
            <a href="{{ url_for('documents.create_document') }}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>
                Ø¥Ø¶Ø§ÙØ© ÙˆØ«ÙŠÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </a>
        </div>
    </div>



    <!-- Bulk Actions -->
    <div class="row mb-3" id="bulk-actions" style="display: none;">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-body py-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span id="selected-count">0</span> ÙˆØ«ÙŠÙ‚Ø© Ù…Ø­Ø¯Ø¯Ø©
                        </div>
                        <div>
                            <button type="button" class="btn btn-danger btn-sm" id="bulk-delete-btn">
                                <i class="fas fa-trash me-1"></i>
                                Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="clear-selection-btn">
                                <i class="fas fa-times me-1"></i>
                                Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Documents List -->
    {% if documents.items %}
    <!-- Select All Controls -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="select-all">
                <label class="form-check-label" for="select-all">
                    ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©
                </label>
            </div>
        </div>
    </div>

    <div class="row">
        {% for document in documents.items %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100" data-document-id="{{ document.id }}">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <!-- Checkbox for selection -->
                        <div class="form-check me-2">
                            <input class="form-check-input document-checkbox" type="checkbox"
                                   value="{{ document.id }}" id="doc-{{ document.id }}">
                        </div>
                        <span class="me-2">
                            {% if document.file_type == 'pdf' %}
                                ğŸ“„
                            {% elif document.file_type in ['doc', 'docx'] %}
                                ğŸ“
                            {% elif document.file_type in ['xls', 'xlsx'] %}
                                ğŸ“Š
                            {% elif document.file_type in ['ppt', 'pptx'] %}
                                ğŸ“ˆ
                            {% elif document.file_type in ['jpg', 'jpeg', 'png', 'gif'] %}
                                ğŸ–¼ï¸
                            {% elif document.file_type == 'txt' %}
                                ğŸ“„
                            {% else %}
                                ğŸ“
                            {% endif %}
                        </span>
                        <h5 class="mb-0">{{ document.title }}</h5>
                    </div>
                    <div class="d-flex gap-2">
                        <!-- File Type Badge -->
                        <span class="badge bg-info">
                            {% if document.file_type == 'pdf' %}
                                PDF
                            {% elif document.file_type in ['doc', 'docx'] %}
                                Word
                            {% elif document.file_type in ['xls', 'xlsx'] %}
                                Excel
                            {% elif document.file_type in ['ppt', 'pptx'] %}
                                PowerPoint
                            {% elif document.file_type in ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff'] %}
                                ØµÙˆØ±Ø©
                            {% elif document.file_type == 'txt' %}
                                Ù†Øµ
                            {% else %}
                                {{ document.file_type.upper() if document.file_type else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                            {% endif %}
                        </span>
                        <!-- Status Badge -->
                        <span class="badge bg-{{ document.get_status_color() }}">
                            {{ document.status|document_status }}
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ document.description|truncate(100) }}</p>
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fas fa-file me-1"></i>
                            <strong>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</strong> {{ document.original_filename }}
                        </small>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fas fa-folder me-1"></i>
                            {% if document.category %}
                                {{ document.category.get_full_path() }}
                            {% else %}
                                ØºÙŠØ± Ù…ØµÙ†Ù
                            {% endif %}
                        </small>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fas fa-user me-1"></i>
                            {{ document.author.get_full_name() }}
                        </small>
                    </div>
                    <div>
                        <small class="text-muted">
                            <i class="fas fa-calendar-alt me-1"></i>
                            {{ document.created_at.strftime('%Y/%m/%d') }}
                        </small>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="btn-group" role="group">
                            <a href="{{ url_for('documents.view_document', id=document.id) }}" class="btn btn-sm btn-primary">
                                <i class="fas fa-eye me-1"></i>
                                Ø¹Ø±Ø¶
                            </a>
                            <a href="{{ url_for('documents.download_document', id=document.id) }}" class="btn btn-sm btn-success">
                                <i class="fas fa-download me-1"></i>
                                ØªÙ†Ø²ÙŠÙ„
                            </a>
                            {% if current_user.can('edit_document') or current_user.id == document.author_id %}
                            <a href="{{ url_for('documents.edit_document', id=document.id) }}" class="btn btn-sm btn-secondary">
                                <i class="fas fa-edit me-1"></i>
                                ØªØ¹Ø¯ÙŠÙ„
                            </a>
                            {% endif %}
                        </div>
                        {% if current_user.can('delete_document') or current_user.id == document.author_id %}
                        <button type="button" class="btn btn-sm btn-outline-danger delete-document-btn"
                                data-document-id="{{ document.id }}"
                                data-document-title="{{ document.title }}">
                            <i class="fas fa-trash"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if documents.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('documents.list_documents',
                    page=documents.prev_num,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    search=current_search,
                    sort=request.args.get('sort', 'newest')) }}">
                    Ø§Ù„Ø³Ø§Ø¨Ù‚
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
            </li>
            {% endif %}

            {% for page_num in documents.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                {% if page_num %}
                    {% if page_num == documents.page %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                    {% else %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('documents.list_documents',
                            page=page_num,
                            main_category=current_main_category,
                            sub_category_1=current_sub_category_1,
                            sub_category_2=current_sub_category_2,
                            sub_category_3=current_sub_category_3,
                            doc_type=current_doc_type,
                            author=current_author,
                            search=current_search,
                            sort=request.args.get('sort', 'newest')) }}">
                            {{ page_num }}
                        </a>
                    </li>
                    {% endif %}
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                {% endif %}
            {% endfor %}

            {% if documents.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('documents.list_documents',
                    page=documents.next_num,
                    main_category=current_main_category,
                    sub_category_1=current_sub_category_1,
                    sub_category_2=current_sub_category_2,
                    sub_category_3=current_sub_category_3,
                    doc_type=current_doc_type,
                    author=current_author,
                    search=current_search,
                    sort=request.args.get('sort', 'newest')) }}">
                    Ø§Ù„ØªØ§Ù„ÙŠ
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">Ø§Ù„ØªØ§Ù„ÙŠ</span>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ«Ø§Ø¦Ù‚ Ù…ØªØ§Ø­Ø©.
        <a href="{{ url_for('documents.create_document') }}" class="alert-link">Ø¥Ø¶Ø§ÙØ© ÙˆØ«ÙŠÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // ÙˆØ¸ÙŠÙØ© Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙÙ„Ø§ØªØ±
    $('#filtersSection').on('show.bs.collapse', function () {
        $('#filter-toggle-text').text('Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ„Ø§ØªØ±');
        $('#filter-toggle-icon').removeClass('fa-chevron-down').addClass('fa-chevron-up');
    });

    $('#filtersSection').on('hide.bs.collapse', function () {
        $('#filter-toggle-text').text('Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙÙ„Ø§ØªØ±');
        $('#filter-toggle-icon').removeClass('fa-chevron-up').addClass('fa-chevron-down');
    });
    // ØªØ­Ø¯ÙŠØ¯/Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
    $('#select-all').change(function() {
        var isChecked = $(this).is(':checked');
        $('.document-checkbox').prop('checked', isChecked);
        updateBulkActions();
    });

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± ØªØ­Ø¯ÙŠØ¯ ÙˆØ«ÙŠÙ‚Ø© ÙØ±Ø¯ÙŠØ©
    $('.document-checkbox').change(function() {
        var totalCheckboxes = $('.document-checkbox').length;
        var checkedCheckboxes = $('.document-checkbox:checked').length;

        $('#select-all').prop('checked', checkedCheckboxes === totalCheckboxes);
        updateBulkActions();
    });

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©
    function updateBulkActions() {
        var checkedCount = $('.document-checkbox:checked').length;
        $('#selected-count').text(checkedCount);

        if (checkedCount > 0) {
            $('#bulk-actions').show();
        } else {
            $('#bulk-actions').hide();
        }
    }

    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
    $('#clear-selection-btn').click(function() {
        $('.document-checkbox').prop('checked', false);
        $('#select-all').prop('checked', false);
        updateBulkActions();
    });

    // Ø­Ø°Ù ÙˆØ«ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
    $('.delete-document-btn').click(function() {
        var documentId = $(this).data('document-id');
        var documentTitle = $(this).data('document-title');

        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© "' + documentTitle + '"ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
            deleteDocument(documentId);
        }
    });

    // Ø­Ø°Ù Ù…ØªØ¹Ø¯Ø¯
    $('#bulk-delete-btn').click(function() {
        var selectedIds = [];
        $('.document-checkbox:checked').each(function() {
            selectedIds.push($(this).val());
        });

        if (selectedIds.length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ÙˆØ«ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­Ø°Ù.');
            return;
        }

        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ' + selectedIds.length + ' ÙˆØ«ÙŠÙ‚Ø©ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
            bulkDeleteDocuments(selectedIds);
        }
    });

    // Ø¯Ø§Ù„Ø© Ø­Ø°Ù ÙˆØ«ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
    function deleteDocument(documentId) {
        console.log('Deleting document:', documentId);
        $.ajax({
            url: '/documents/ajax/delete/' + documentId,
            type: 'POST',
            headers: {
                'X-CSRFToken': $('meta[name=csrf-token]').attr('content')
            },
            success: function(response) {
                if (response.success) {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø©
                    $('[data-document-id="' + documentId + '"]').closest('.col-md-6').fadeOut(function() {
                        $(this).remove();
                        updateBulkActions();

                        // Ø¥Ø°Ø§ Ù„Ù… ØªØ¹Ø¯ Ù‡Ù†Ø§Ùƒ ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø­Ø¯Ø¯Ø©ØŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±
                        if ($('.document-checkbox:checked').length === 0) {
                            $('#selected-count-alert').hide();
                            $('#bulk-actions').hide();
                        }
                    });

                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ' + response.message, 'danger');
                }
            },
            error: function() {
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©', 'danger');
            }
        });
    }

    // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù…ØªØ¹Ø¯Ø¯
    function bulkDeleteDocuments(documentIds) {
        console.log('Bulk deleting documents:', documentIds);

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
        var formData = new FormData();
        documentIds.forEach(function(id) {
            formData.append('document_ids', id);
        });

        console.log('FormData prepared, sending request...');

        $.ajax({
            url: '/documents/bulk-delete',
            type: 'POST',
            headers: {
                'X-CSRFToken': $('meta[name=csrf-token]').attr('content')
            },
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø©
                    documentIds.forEach(function(id) {
                        $('[data-document-id="' + id + '"]').closest('.col-md-6').fadeOut(function() {
                            $(this).remove();
                        });
                    });

                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…ØªØ¹Ø¯Ø¯
                    $('#selected-count-alert').hide();
                    $('#bulk-actions').hide();

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                    $('#select-all').prop('checked', false);
                    $('.document-checkbox').prop('checked', false);
                    updateBulkActions();

                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    showAlert('ØªÙ… Ø­Ø°Ù ' + response.deleted_count + ' ÙˆØ«ÙŠÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚: ' + response.message, 'danger');
                }
            },
            error: function(xhr, status, error) {
                console.error('Bulk delete error:', xhr, status, error);
                console.error('Response text:', xhr.responseText);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚: ' + error, 'danger');
            }
        });
    }

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
    function showAlert(message, type) {
        var alertHtml = '<div class="alert alert-' + type + ' alert-dismissible fade show" role="alert">' +
                       '<i class="fas fa-' + (type === 'success' ? 'check-circle' : 'exclamation-triangle') + ' me-2"></i>' +
                       message +
                       '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>' +
                       '</div>';

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
        $('.container-fluid').prepend(alertHtml);

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
        setTimeout(function() {
            $('.alert').fadeOut();
        }, 5000);
    }

    // Hierarchical category filters functionality
    const form = document.getElementById('filterForm');
    const mainCategorySelect = document.getElementById('main_category');
    const subCategory1Select = document.getElementById('sub_category_1');
    const subCategory2Select = document.getElementById('sub_category_2');
    const subCategory3Select = document.getElementById('sub_category_3');

    // Function to clear and disable a select
    function clearAndDisableSelect(select) {
        select.innerHTML = '<option value="">ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©</option>';
        select.disabled = true;
        select.value = '';
    }

    // Function to load subcategories
    function loadSubcategories(parentId, targetSelect, placeholder) {
        if (!parentId) {
            clearAndDisableSelect(targetSelect);
            return;
        }

        // Show loading
        targetSelect.innerHTML = '<option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';
        targetSelect.disabled = false;

        fetch(`{{ url_for('documents.get_subcategories', parent_id=0) }}`.replace('0', parentId))
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    targetSelect.innerHTML = `<option value="">${placeholder}</option>`;
                    data.subcategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = 'ğŸ“‚ ' + category.name;
                        targetSelect.appendChild(option);
                    });

                    // Restore selected value if exists
                    const currentValue = targetSelect.dataset.currentValue;
                    if (currentValue) {
                        targetSelect.value = currentValue;
                        targetSelect.dataset.currentValue = '';
                    }
                } else {
                    targetSelect.innerHTML = `<option value="">${placeholder}</option>`;
                }
            })
            .catch(error => {
                console.error('Error loading subcategories:', error);
                targetSelect.innerHTML = `<option value="">${placeholder}</option>`;
            });
    }

    // Main category change handler
    if (mainCategorySelect) {
        mainCategorySelect.addEventListener('change', function() {
            const selectedValue = this.value;

            // Clear all subcategory selects
            clearAndDisableSelect(subCategory1Select);
            clearAndDisableSelect(subCategory2Select);
            clearAndDisableSelect(subCategory3Select);

            if (selectedValue) {
                loadSubcategories(selectedValue, subCategory1Select, 'ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©');
            }

            // Auto-submit form
            form.submit();
        });
    }

    // Sub category 1 change handler
    if (subCategory1Select) {
        subCategory1Select.addEventListener('change', function() {
            const selectedValue = this.value;

            // Clear subsequent selects
            clearAndDisableSelect(subCategory2Select);
            clearAndDisableSelect(subCategory3Select);

            if (selectedValue) {
                loadSubcategories(selectedValue, subCategory2Select, 'ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ© Ø«Ø§Ù†ÙŠØ©');
            }

            // Auto-submit form
            form.submit();
        });
    }

    // Sub category 2 change handler
    if (subCategory2Select) {
        subCategory2Select.addEventListener('change', function() {
            const selectedValue = this.value;

            // Clear subsequent select
            clearAndDisableSelect(subCategory3Select);

            if (selectedValue) {
                loadSubcategories(selectedValue, subCategory3Select, 'ğŸ“ Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ© Ø«Ø§Ù„Ø«Ø©');
            }

            // Auto-submit form
            form.submit();
        });
    }

    // Sub category 3 change handler
    if (subCategory3Select) {
        subCategory3Select.addEventListener('change', function() {
            // Auto-submit form
            form.submit();
        });
    }

    // Initialize on page load
    const currentMainCategory = {{ current_main_category or 'null' }};
    const currentSubCategory1 = {{ current_sub_category_1 or 'null' }};
    const currentSubCategory2 = {{ current_sub_category_2 or 'null' }};
    const currentSubCategory3 = {{ current_sub_category_3 or 'null' }};

    if (currentMainCategory) {
        subCategory1Select.dataset.currentValue = currentSubCategory1 || '';
        loadSubcategories(currentMainCategory, subCategory1Select, '-- Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ --');

        if (currentSubCategory1) {
            subCategory2Select.dataset.currentValue = currentSubCategory2 || '';
            loadSubcategories(currentSubCategory1, subCategory2Select, '-- Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© --');

            if (currentSubCategory2) {
                subCategory3Select.dataset.currentValue = currentSubCategory3 || '';
                loadSubcategories(currentSubCategory2, subCategory3Select, '-- Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø© --');
            }
        }
    }

    // Auto-submit form when other filters change
    const otherFilterInputs = form.querySelectorAll('#search, #doc_type, #author');
    otherFilterInputs.forEach(input => {
        input.addEventListener('change', function() {
            form.submit();
        });
    });
});

// Function to remove specific filter
function removeFilter(filterType) {
    const currentUrl = new URL(window.location);
    const params = currentUrl.searchParams;

    // Remove the specific filter parameter
    switch(filterType) {
        case 'search':
            params.delete('search');
            break;
        case 'main_category':
            params.delete('main_category');
            params.delete('sub_category_1');
            params.delete('sub_category_2');
            params.delete('sub_category_3');
            break;
        case 'sub_category_1':
            params.delete('sub_category_1');
            params.delete('sub_category_2');
            params.delete('sub_category_3');
            break;
        case 'sub_category_2':
            params.delete('sub_category_2');
            params.delete('sub_category_3');
            break;
        case 'sub_category_3':
            params.delete('sub_category_3');
            break;
        case 'doc_type':
            params.delete('doc_type');
            break;
        case 'author':
            params.delete('author');
            break;
        case 'date':
            params.delete('start_date');
            params.delete('end_date');
            params.delete('time_filter');
            break;
    }

    // Reset page to 1 when removing filters
    params.delete('page');

    // Redirect to the new URL
    window.location.href = currentUrl.toString();
}

// Function to clear all filters
function clearAllFilters() {
    // Redirect to the base URL without any parameters
    window.location.href = '{{ url_for("documents.list_documents") }}';
}

// Add Enter key support for date filters
document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    const form = document.getElementById('filter-form');

    // Add Enter key listener to date inputs
    if (startDateInput) {
        startDateInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                form.submit();
            }
        });
    }

    if (endDateInput) {
        endDateInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                form.submit();
            }
        });
    }

    // Add hover effects for filter badges
    const filterBadges = document.querySelectorAll('.filter-badge');

    filterBadges.forEach(badge => {
        badge.addEventListener('mouseenter', function() {
            this.style.opacity = '0.8';
            this.style.transform = 'scale(1.05)';
        });

        badge.addEventListener('mouseleave', function() {
            this.style.opacity = '1';
            this.style.transform = 'scale(1)';
        });
    });
});
</script>

<style>
.filter-badge {
    transition: all 0.2s ease-in-out;
}

.filter-badge:hover {
    opacity: 0.8 !important;
    transform: scale(1.05) !important;
}
</style>
{% endblock %}





